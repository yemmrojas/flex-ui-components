# FlexUI - JSON Compose Renderer

[![Kotlin](https://img.shields.io/badge/Kotlin-2.0.21-blue.svg)](https://kotlinlang.org)
[![Compose](https://img.shields.io/badge/Jetpack%20Compose-2024.09.00-green.svg)](https://developer.android.com/jetpack/compose)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Min SDK](https://img.shields.io/badge/Min%20SDK-24-orange.svg)](https://developer.android.com/about/versions/nougat)

Una librer√≠a Android moderna que renderiza interfaces de usuario de Jetpack Compose din√°micamente a partir de configuraciones JSON. Ideal para prototipado r√°pido, Server-Driven UI (SDUI), y aplicaciones que requieren interfaces configurables sin recompilaci√≥n.

## ‚ú® Caracter√≠sticas

- **üé® Renderizado Din√°mico**: Crea UIs completas desde JSON sin recompilar c√≥digo
- **üì¶ Componentes Modulares**: 6 contenedores de layout + 9 componentes at√≥micos listos para usar
- **üîÑ Arquitectura Limpia**: Separaci√≥n clara entre interpretaci√≥n y renderizaci√≥n
- **‚ö° Alto Rendimiento**: Optimizado con remember, keys, lazy loading y caching
- **üõ°Ô∏è Manejo Robusto de Errores**: Error boundaries y placeholders visuales
- **üéØ Type-Safe**: Aprovecha el sistema de tipos de Kotlin con sealed classes
- **üß™ Testeable**: Arquitectura modular dise√±ada para testing

## üìã Requisitos

- Android SDK 24+
- Kotlin 2.0.21+
- Jetpack Compose 2024.09.00+

## üöÄ Instalaci√≥n

### Gradle (Kotlin DSL)

```kotlin
// En tu archivo settings.gradle.kts
dependencyResolutionManagement {
    repositories {
        google()
        mavenCentral()
        // Agregar repositorio cuando est√© publicado
    }
}

// En tu m√≥dulo app/build.gradle.kts
dependencies {
    implementation("com.libs.flex.ui:flexui:1.0.0")
}
```

## üìñ Uso B√°sico

### 1. Configuraci√≥n Simple

```kotlin
import com.libs.flex.ui.flexui.JsonRenderer
import androidx.compose.runtime.Composable

@Composable
fun MyScreen() {
    val jsonConfig = """
        {
          "id": "main",
          "type": "contentVertical",
          "children": [
            {
              "id": "title",
              "type": "componentTextView",
              "text": "¬°Hola FlexUI!",
              "textStyle": "bold",
              "fontSize": 24
            },
            {
              "id": "submit_btn",
              "type": "componentButton",
              "text": "Enviar",
              "buttonStyle": "primary"
            }
          ]
        }
    """.trimIndent()
    
    JsonRenderer(
        jsonString = jsonConfig,
        onEvent = { event ->
            // Manejar eventos de interacci√≥n
            println("Event: $event")
        }
    )
}
```

### 2. Manejo de Eventos

```kotlin
JsonRenderer(
    jsonString = jsonConfig,
    onEvent = { event ->
        when (event) {
            is ComponentEvent.Click -> {
                println("Clicked: ${event.componentId}")
                event.actionId?.let { action ->
                    handleAction(action)
                }
            }
            is ComponentEvent.ValueChange -> {
                println("Value changed: ${event.componentId} = ${event.value}")
                updateFormData(event.componentId, event.value)
            }
            is ComponentEvent.Selection -> {
                println("Selected: ${event.componentId} = ${event.selectedValue}")
                updateSelection(event.componentId, event.selectedValue)
            }
        }
    }
)
```

### 3. Manejo de Errores Personalizado

```kotlin
JsonRenderer(
    jsonString = jsonConfig,
    onEvent = { event -> handleEvent(event) },
    errorContent = { error ->
        Column(
            modifier = Modifier.fillMaxSize(),
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.Center
        ) {
            Icon(Icons.Default.Error, contentDescription = null)
            Text("Error: ${error.message}")
            Button(onClick = { retry() }) {
                Text("Reintentar")
            }
        }
    }
)
```

## üß© Componentes Disponibles

### Contenedores de Layout

| Tipo | Descripci√≥n | Propiedades Clave |
|------|-------------|-------------------|
| `contentVertical` | Organiza componentes en columna | `arrangement`, `alignment`, `children` |
| `contentHorizontal` | Organiza componentes en fila | `arrangement`, `alignment`, `children` |
| `contentScroll` | Contenedor scrollable | `scrollDirection`, `children` |
| `contentWithFloatingButton` | Scaffold con FAB | `fabIcon`, `fabPosition`, `children` |
| `contentList` | Lista lazy optimizada | `items`, `itemTemplate` |
| `contentSlider` | Slider de im√°genes | `items`, `autoPlay`, `autoPlayInterval` |

### Componentes At√≥micos

| Tipo | Descripci√≥n | Propiedades Clave |
|------|-------------|-------------------|
| `componentTextView` | Texto estilizado | `text`, `textStyle`, `fontSize`, `color`, `maxLines` |
| `componentInput` | Campo de entrada | `label`, `placeholder`, `inputStyle`, `validation` |
| `componentButton` | Bot√≥n interactivo | `text`, `buttonStyle`, `actionId` |
| `componentCheck` | Checkbox con label | `label`, `checked` |
| `componentSelect` | Dropdown menu | `label`, `options`, `placeholder` |
| `componentSliderCheck` | Slider num√©rico | `min`, `max`, `value`, `label` |
| `componentImage` | Imagen desde URL | `imageUrl`, `contentScale` |
| `componentLoader` | Indicador de carga | `loaderStyle`, `color`, `size` |
| `componentToast` | Notificaci√≥n Snackbar | `message`, `duration`, `toastType` |

## üìù Ejemplos de JSON

### Formulario Completo

```json
{
  "id": "registration_form",
  "type": "contentScroll",
  "style": {
    "padding": {
      "start": 16,
      "top": 16,
      "end": 16,
      "bottom": 16
    }
  },
  "children": [
    {
      "id": "header",
      "type": "componentTextView",
      "text": "Registro de Usuario",
      "textStyle": "bold",
      "fontSize": 28,
      "color": "#1976D2",
      "style": {
        "padding": { "bottom": 24 }
      }
    },
    {
      "id": "name_input",
      "type": "componentInput",
      "label": "Nombre completo",
      "placeholder": "Ingresa tu nombre",
      "inputStyle": "outlined",
      "validation": {
        "required": true,
        "minLength": 2,
        "errorMessage": "El nombre debe tener al menos 2 caracteres"
      }
    },
    {
      "id": "email_input",
      "type": "componentInput",
      "label": "Correo electr√≥nico",
      "placeholder": "ejemplo@correo.com",
      "inputStyle": "outlined",
      "validation": {
        "required": true,
        "pattern": "^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$",
        "errorMessage": "Formato de correo inv√°lido"
      }
    },
    {
      "id": "country_select",
      "type": "componentSelect",
      "label": "Pa√≠s",
      "placeholder": "Selecciona tu pa√≠s",
      "options": [
        { "label": "M√©xico", "value": "mx" },
        { "label": "Colombia", "value": "co" },
        { "label": "Argentina", "value": "ar" },
        { "label": "Espa√±a", "value": "es" }
      ]
    },
    {
      "id": "age_slider",
      "type": "componentSliderCheck",
      "label": "Edad",
      "min": 18,
      "max": 100,
      "value": 25
    },
    {
      "id": "terms_check",
      "type": "componentCheck",
      "label": "Acepto los t√©rminos y condiciones",
      "checked": false
    },
    {
      "id": "newsletter_check",
      "type": "componentCheck",
      "label": "Suscribirme al bolet√≠n",
      "checked": true
    },
    {
      "id": "button_container",
      "type": "contentHorizontal",
      "arrangement": "spaceEvenly",
      "style": {
        "padding": { "top": 24 }
      },
      "children": [
        {
          "id": "cancel_btn",
          "type": "componentButton",
          "text": "Cancelar",
          "buttonStyle": "secondary",
          "actionId": "cancel_registration"
        },
        {
          "id": "submit_btn",
          "type": "componentButton",
          "text": "Registrarse",
          "buttonStyle": "primary",
          "actionId": "submit_registration"
        }
      ]
    }
  ]
}
```

### Slider de Im√°genes con Auto-Play

```json
{
  "id": "promo_slider",
  "type": "contentSlider",
  "autoPlay": true,
  "autoPlayInterval": 3000,
  "items": [
    "https://example.com/promo1.jpg",
    "https://example.com/promo2.jpg",
    "https://example.com/promo3.jpg"
  ],
  "style": {
    "height": "200dp",
    "borderRadius": 12
  }
}
```

### Lista Din√°mica

```json
{
  "id": "product_list",
  "type": "contentList",
  "items": [
    { "id": "1", "name": "Producto A", "price": "$10.00" },
    { "id": "2", "name": "Producto B", "price": "$20.00" },
    { "id": "3", "name": "Producto C", "price": "$30.00" }
  ],
  "itemTemplate": {
    "id": "item_{{id}}",
    "type": "contentHorizontal",
    "arrangement": "spaceBetween",
    "children": [
      {
        "id": "name_{{id}}",
        "type": "componentTextView",
        "text": "{{name}}",
        "textStyle": "semiBold"
      },
      {
        "id": "price_{{id}}",
        "type": "componentTextView",
        "text": "{{price}}",
        "color": "#4CAF50"
      }
    ]
  }
}
```

## üé® Sistema de Estilos

### Propiedades de Estilo Disponibles

```json
{
  "style": {
    "padding": {
      "start": 16,
      "top": 8,
      "end": 16,
      "bottom": 8
    },
    "margin": {
      "start": 0,
      "top": 0,
      "end": 0,
      "bottom": 0
    },
    "backgroundColor": "#FFFFFF",
    "borderRadius": 8,
    "elevation": 4,
    "width": "match_parent",
    "height": "wrap_content"
  }
}
```

### Valores de Dimensi√≥n

- Valores num√©ricos: `16` (interpretado como dp)
- Con unidad: `"16dp"`
- Especiales: `"match_parent"`, `"wrap_content"`

### Colores

Formato hexadecimal: `"#RRGGBB"` o `"#AARRGGBB"`

Ejemplos:
- `"#FF0000"` - Rojo
- `"#80000000"` - Negro semi-transparente
- `"#1976D2"` - Azul Material

## üèóÔ∏è Arquitectura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Client Application              ‚îÇ
‚îÇ  (MainActivity, ViewModels, etc.)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         JsonRenderer API                ‚îÇ
‚îÇ  (Public Composable Function)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ               ‚îÇ
             ‚ñº               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Interpretation     ‚îÇ  ‚îÇ Visual           ‚îÇ
‚îÇ Module             ‚îÇ  ‚îÇ Components       ‚îÇ
‚îÇ                    ‚îÇ  ‚îÇ Module           ‚îÇ
‚îÇ ‚Ä¢ JsonParser       ‚îÇ  ‚îÇ                  ‚îÇ
‚îÇ ‚Ä¢ ComponentMapper  ‚îÇ  ‚îÇ ‚Ä¢ ComponentFactory‚îÇ
‚îÇ ‚Ä¢ ValidationEngine ‚îÇ  ‚îÇ ‚Ä¢ Containers     ‚îÇ
‚îÇ                    ‚îÇ  ‚îÇ ‚Ä¢ Atomic Comps   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### M√≥dulos Principales

**Interpretation Module** (`parser/`)
- Parseo de JSON con kotlinx.serialization
- Validaci√≥n de estructura y propiedades
- Mapeo de tipos string a enums
- Construcci√≥n del √°rbol de componentes

**Visual Components Module** (`components/`)
- Renderizado de componentes Compose
- Aplicaci√≥n de estilos y propiedades
- Manejo de estado interno
- Emisi√≥n de eventos de interacci√≥n

**Event System** (`events/`)
- Propagaci√≥n de eventos de usuario
- Callbacks type-safe
- Ejecuci√≥n en hilo principal

## üîß Configuraci√≥n Avanzada

### Caching de Componentes

La librer√≠a incluye caching autom√°tico para evitar parseo redundante:

```kotlin
// El cache se maneja internamente
// Los componentes se cachean por hash MD5 del JSON
JsonRenderer(jsonString = config) // Primera vez: parsea
JsonRenderer(jsonString = config) // Segunda vez: usa cache
```

### Validaci√≥n Personalizada

```json
{
  "id": "password_input",
  "type": "componentInput",
  "label": "Contrase√±a",
  "inputStyle": "outlined",
  "validation": {
    "required": true,
    "minLength": 8,
    "pattern": "^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d]{8,}$",
    "errorMessage": "M√≠nimo 8 caracteres, debe incluir letras y n√∫meros"
  }
}
```

## üß™ Testing

### Unit Tests

```kotlin
class JsonParserTest {
    private val parser = JsonParser()
    
    @Test
    fun `parse should return success when JSON is valid`() = runBlocking {
        val validJson = """{"id": "test", "type": "componentButton", "text": "Click"}"""
        val result = parser.parse(validJson)
        
        assertTrue(result.isSuccess)
        assertEquals("test", result.getOrNull()?.id)
    }
    
    @Test
    fun `parse should throw ComponentTypeNotFoundException for unknown type`() = runBlocking {
        val invalidJson = """{"id": "test", "type": "unknownType"}"""
        val result = parser.parse(invalidJson)
        
        assertTrue(result.isFailure)
        assertTrue(result.exceptionOrNull() is ComponentTypeNotFoundException)
    }
}
```

### Compose UI Tests

```kotlin
class ButtonComponentTest {
    @get:Rule
    val composeTestRule = createComposeRule()
    
    @Test
    fun `button click should trigger event callback`() {
        var eventReceived: ComponentEvent? = null
        val descriptor = AtomicDescriptor(
            id = "test_btn",
            type = ComponentType.COMPONENT_BUTTON,
            text = "Click Me",
            buttonStyle = "primary"
        )
        
        composeTestRule.setContent {
            ButtonComponent(
                descriptor = descriptor,
                onEvent = { eventReceived = it }
            )
        }
        
        composeTestRule.onNodeWithText("Click Me").performClick()
        
        assertNotNull(eventReceived)
        assertTrue(eventReceived is ComponentEvent.Click)
        assertEquals("test_btn", (eventReceived as ComponentEvent.Click).componentId)
    }
}
```

## üìä Rendimiento

### Optimizaciones Implementadas

- ‚úÖ Parseo as√≠ncrono en background thread (Dispatchers.IO)
- ‚úÖ Caching de componentes parseados (MD5 hash)
- ‚úÖ Uso de `remember` y `derivedStateOf` para c√°lculos costosos
- ‚úÖ Keys estables en LazyColumn para optimizar recomposici√≥n
- ‚úÖ Lazy loading de im√°genes con Coil
- ‚úÖ Manejo eficiente de memoria con WeakReference en cache

### Benchmarks

| Operaci√≥n | Tiempo Promedio |
|-----------|-----------------|
| Parseo JSON simple (5 componentes) | ~15ms |
| Parseo JSON complejo (50 componentes) | ~80ms |
| Renderizado inicial | ~30ms |
| Recomposici√≥n con cache | ~5ms |

## üõ°Ô∏è Manejo de Errores

### Tipos de Excepciones

```kotlin
sealed class FlexUIException : Exception()

class JsonParseException(message: String, cause: Throwable?)
class ComponentTypeNotFoundException(val type: String)
class MissingPropertyException(val property: String, val componentType: String)
class ValidationException(val errors: List<String>)
class RenderException(message: String, cause: Throwable?)
```

### Error Boundaries

Los errores de renderizado se manejan a nivel de componente individual:

```kotlin
// Si un componente falla, se renderiza un placeholder
// El resto de la UI contin√∫a funcionando
ErrorPlaceholder(message = "Error al renderizar componente")
```

## ü§ù Contribuci√≥n

Las contribuciones son bienvenidas. Por favor:

1. Fork el repositorio
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

### Est√°ndares de C√≥digo

- Seguir [Kotlin Coding Conventions](https://kotlinlang.org/docs/coding-conventions.html)
- Usar [Jetpack Compose Guidelines](https://developer.android.com/jetpack/compose/guidelines)
- Escribir tests para nuevas funcionalidades
- Documentar APIs p√∫blicas con KDoc

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver el archivo [LICENSE](LICENSE) para m√°s detalles.

## üôè Agradecimientos

- [Jetpack Compose](https://developer.android.com/jetpack/compose) - Framework UI
- [kotlinx.serialization](https://github.com/Kotlin/kotlinx.serialization) - Serializaci√≥n JSON
- [Coil](https://coil-kt.github.io/coil/) - Carga de im√°genes

## üìû Contacto

- **Issues**: [GitHub Issues](https://github.com/yourusername/flexui/issues)
- **Discussions**: [GitHub Discussions](https://github.com/yourusername/flexui/discussions)

## üó∫Ô∏è Roadmap

### v1.0.0 (MVP - Actual)
- ‚úÖ 6 contenedores de layout
- ‚úÖ 9 componentes at√≥micos
- ‚úÖ Sistema de eventos
- ‚úÖ Manejo de errores robusto
- ‚úÖ Caching b√°sico

### v1.1.0 (Pr√≥ximo)
- [ ] Soporte para animaciones desde JSON
- [ ] Componentes personalizados (plugin system)
- [ ] Temas din√°micos
- [ ] Validaci√≥n en tiempo real
- [ ] Modo debug con inspector visual

### v2.0.0 (Futuro)
- [ ] Server-Driven UI completo con sincronizaci√≥n
- [ ] A/B testing integrado
- [ ] Analytics de interacciones
- [ ] Soporte para gestos personalizados
- [ ] Editor visual de JSON

---

**Hecho con ‚ù§Ô∏è usando Kotlin y Jetpack Compose**
